modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;];[^;];",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;];[^;];",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
View(infocasd)
"str_replace("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"str_replace("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"str_replace_all("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"SEXE;Sexe;1 - Homme;2 - Femme" %>% str_replace("^[^;];[^;];","")
"SEXE;Sexe;1 - Homme;2 - Femme" %>% str_replace("^[^;]","")
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]+;[^;]+;"),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]+;[^;]+;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
View(infocasd)
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & novmar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & novmar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & nomvar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
View(infocasd)
infocasd <- infocasd_ %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(nomtab = nomtab %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
View(infocasd)
infocasd <- infocasd_ %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
table = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(table,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(table = table %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="#",encoding="UTF-8")
variables_eir <- infocasd %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
table = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(table,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(table = table %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
View(variables_eir)
View(variables_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites))
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace(modalites,"[^;]","")+1))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace(modalites,"[^;]",""))+1)
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1)
View(modalites_eir)
?slice
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
slice(rep(1:n()), each=nbmodalites)
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n()), each=nbmodalites) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
#group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
ungroup()
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(strsplit(modalites,";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,sep=";"))) %>%
ungroup()
unlist(str_split(modalites_eir$modalites[1],sep=";"))
unlist(strsplit(modalites_eir$modalites[1],sep=";"))
?strsplit
unlist(strsplit(modalites_eir$modalites[1],split=";"))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,split=";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites[1],split=";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup()
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalite = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup() %>%
mutate(intitule = modalite %>% str_replace("^[^\\-]*\\-[[:space:]]*",""),
modalite = modalite %>% str_extract("^[^\\-]*") %>% trimws())
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalite = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup() %>%
mutate(intitule = modalite %>% str_replace("^[^\\-]*\\-[[:space:]]*",""),
modalite = modalite %>% str_extract("^[^\\-]*") %>% trimws()) %>%
select(table,variable,modalite,intitule)
View(modalites_eir)
usethis::use_data(variables_eir, modalites_eir,      overwrite=TRUE)
# == sauvegarde des bases en format .csv
write.csv2(variables_eir,
file=gzfile("data-raw/variables_eir.csv.gz"),
row.names = FALSE, fileEncoding = "UTF-8")
write.csv2(modalites_eir,
file=gzfile("data-raw/modalites_eir.csv.gz"),
row.names = FALSE, fileEncoding = "UTF-8")
document()
var<- "depant"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(var)) %>%
select(modalite,intitule) %>%
distinct()
tab
setNames(tab$modalite,tab$intitule)
truc <- setNames(tab$modalite,tab$intitule)
recode(c("2","1","3"), !!! truc
)
truc
truc <- setNames(tab$intitule,tab$modalite)
recode(c("2","1","3"), !!! truc)
var <- c("1","4",NA)
novmar<-"typdd"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
nomvar<-"typdd"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
nomvar<-"depant"
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
setNames(tab$intitule , tab$modalite)
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
recode_modalites_eir <- function(nomvar) {
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
return( recode(as.character({{nomvar}}), !!! setNames(tab$intitule , tab$modalite) ) )
}
depant <- c(1,2,3,4)
recode_modalites_eir("depant")
recode_modalites_eir(depant)
recode_modalites_eir(depant,"depant")
recode_modalites_eir <- function(var,nomvar=NA) {
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
return( recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) ) )
}
recode_modalites_eir(depant)
recode_modalites_eir(depant,"depant")
load_all()
load_all()
rm(list = c("recode_modalites_eir"))
load_all()
load_all()
document()
build_site()
library(devtools)
load_all()
library(tidyverse)
View(variables_eir)
View(modalites_eir)
tab_rev_rg <- read.csv2(  "https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/0/revalorisation_pension/revalorisation_pension.csv",sep=",",header=TRUE)
names(tab_rev_rg) <- c("date","coeff")
tab_rev_rg <- tab_rev_rg %>% mutate( date = as.Date(date , format="%Y-%m-%d"))
tab_rev_fp <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/1/pension_civile/revalorisation_pension/revalorisation_pension.csv",sep=",",header=TRUE)
names(tab_rev_fp) <- c("date","coeff")
tab_rev_fp <- tab_rev_fp %>% mutate( date = as.Date(date , format="%Y-%m-%d"))
tab_rev_base <- bind_rows(tab_rev_rg %>% mutate(cc="0010"), tab_rev_fp %>% mutate(cc="0012")) %>%
arrange(cc,date) %>%
group_by(cc) %>% mutate(indicerevalo=cumprod(coeff)) %>% ungroup() %>%
select(-coeff)
View(tab_rev_base)
View(tab_rev_base)
tab_rev_arrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/arrco/point/point.csv",sep=",",header=TRUE)
tab_rev_agirc <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc/point/point.csv",sep=",",header=TRUE)
tab_rev_unirs <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/unirs/point/point.csv",sep=",",header=TRUE)
tab_rev_ircantec <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/1/regimes_complementaires/ircantec/ircantec.csv",sep=",",header=TRUE)
tab_rev_rci <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rci/pt_rci.csv",sep=",",header=TRUE)
names(tab_rev_rci)[1:2] <- c("date","valeur_point_en_euros")
tab_rev_rcia <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_art/pt_rc_art.csv",sep=",",header=TRUE)
tab_rev_rcic <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_com/pt_rc_com.csv",sep=",",header=TRUE)
tab_rev_compl <- bind_rows(
tab_rev_arrco %>% select(date,valeur_point_en_euros) %>%
mutate(cc="6000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)),
tab_rev_unirs %>% select(date,valeur_point_en_euros) %>%
mutate(cc="6000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)/0.3874644222106022),
tab_rev_agirc %>% select(date,valeur_point_en_euros) %>%
mutate(cc="5000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)) ,
tab_rev_ircantec %>% select(date,valeur_du_point) %>%
mutate(cc="1000",valeur_point_en_euros=as.numeric(valeur_du_point))  ) %>%
mutate( date = as.Date(date , format="%Y-%m-%d")) %>%
rename(indicerevalo=valeur_point_en_euros) %>%
select(date,cc,indicerevalo)
View(tab_rev_compl)
View(tab_rev_agirc)
View(tab_rev_base)
View(tab_rev_agirc)
View(tab_rev_arrco)
View(tab_rev_rcic)
View(tab_rev_unirs)
View(tab_rev_rcic)
View(tab_rev_rci)
tab_rev_agircarrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc_arrco/point/point.csv",sep=",",header=TRUE)
tab_rev_arrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/arrco/point/point.csv",sep=",",header=TRUE)
tab_rev_agircarrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc_arrco/point/point.csv",sep=",",header=TRUE)
View(tab_rev_compl)
View(tab_rev_base)
View(tab_rev_ircantec)
View(tab_rev_agirc)
View(tab_rev_base)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date)
View(tab_rev)
View(tab_rev)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = as.Date(date,format="%Y") %>% as.numeric(),
mois = as.Date(date,format="%m") %>% as.numeric(),
jour = as.Date(date,format="%d") %>% as.numeric())
View(tab_rev)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = Date(date,format="%Y") %>% as.numeric(),
mois = Date(date,format="%m") %>% as.numeric(),
jour = Date(date,format="%d") %>% as.numeric())
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = format(date,format="%Y") %>% as.numeric(),
mois = format(date,format="%m") %>% as.numeric(),
jour = format(date,format="%d") %>% as.numeric())
View(tab_rev)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = format(date,format="%Y") %>% as.numeric(),
mois = format(date,format="%m") %>% as.numeric(),
jour = format(date,format="%d") %>% as.numeric()) %>%
relocate("annee",.after="date")
View(tab_rev)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = format(date,format="%Y") %>% as.numeric(),
mois = format(date,format="%m") %>% as.numeric(),
jour = format(date,format="%d") %>% as.numeric()) %>%
relocate("annee",.after="date")  %>%
relocate("indicerevalo",.after="jour")
View(tab_rev)
tab_rev_agircarrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc_arrco/point/point.csv",sep=",",header=TRUE)
View(tab_rev_agirc)
tab_rev_agircarrco <- data_frame(
date= c("2019-11-01","2021-11-01"),
valeur_point_en_euros=c(1.2714,1.2841)
)
tab_rev_agircarrco <- dataframe(
date= c("2019-11-01","2021-11-01"),
valeur_point_en_euros=c(1.2714,1.2841)
)
tab_rev_agircarrco <- data.frame(
date= c("2019-11-01","2021-11-01"),
valeur_point_en_euros=c(1.2714,1.2841)
)
View(tab_rev_agircarrco)
tab_rev_arrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/arrco/point/point.csv",sep=",",header=TRUE)
tab_rev_agirc <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc/point/point.csv",sep=",",header=TRUE)
tab_rev_unirs <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/unirs/point/point.csv",sep=",",header=TRUE)
tab_rev_ircantec <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/1/regimes_complementaires/ircantec/ircantec.csv",sep=",",header=TRUE)
tab_rev_rci <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rci/pt_rci.csv",sep=",",header=TRUE)
names(tab_rev_rci)[1:2] <- c("date","valeur_point_en_euros")
tab_rev_rcia <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_art/pt_rc_art.csv",sep=",",header=TRUE)
tab_rev_rcic <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_com/pt_rc_com.csv",sep=",",header=TRUE)
tab_rev_agircarrco <- data.frame(
date= c("2019-11-01","2021-11-01"),
valeur_point_en_euros=c(1.2714,1.2841)
)
# conversion en valeur du point Agirc-Arrco après la fusion de 2019
tab_rev_agirc <- tab_rev_agirc %>% mutate(valeur_point_en_euros=valeur_point_en_euros*1.2588/0.4378)
tab_rev_arrco <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/arrco/point/point.csv",sep=",",header=TRUE)
tab_rev_agirc <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/agirc/point/point.csv",sep=",",header=TRUE)
tab_rev_unirs <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/0/1/0/unirs/point/point.csv",sep=",",header=TRUE)
tab_rev_ircantec <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/1/regimes_complementaires/ircantec/ircantec.csv",sep=",",header=TRUE)
tab_rev_rci <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rci/pt_rci.csv",sep=",",header=TRUE)
names(tab_rev_rci)[1:2] <- c("date","valeur_point_en_euros")
tab_rev_rcia <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_art/pt_rc_art.csv",sep=",",header=TRUE)
tab_rev_rcic <- read.csv2("https://www.ipp.eu/wp-content/themes/ipp/baremes/regimes-de-retraites/2/pt_rc_com/pt_rc_com.csv",sep=",",header=TRUE)
tab_rev_agircarrco <- data.frame(
date= c("2019-11-01","2021-11-01"),
valeur_point_en_euros=c(1.2714,1.2841)
)
tab_rev_compl <- bind_rows(
# AGIRC-ARRCO après la fusion (2019)
tab_rev_agircarrco  %>%
mutate(cc="6000"),
# ARRCO jusqu'en 2019, précédé par l'UNIRS
tab_rev_arrco %>% select(date,valeur_point_en_euros) %>%
mutate(cc="6000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)),
tab_rev_unirs %>% select(date,valeur_point_en_euros) %>%
mutate(cc="6000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)/0.3874644222106022),
# AGIRC jusqu'en 2019
tab_rev_agirc %>% select(date,valeur_point_en_euros) %>%
mutate(cc="5000",valeur_point_en_euros=as.numeric(valeur_point_en_euros)) %>%
# conversion en valeur du point Agirc-Arrco après la fusion de 2019
mutate(valeur_point_en_euros=valeur_point_en_euros*1.2588/0.4378),
# IRCANTEC
tab_rev_ircantec %>% select(date,valeur_du_point) %>%
mutate(cc="1000",valeur_point_en_euros=as.numeric(valeur_du_point))
) %>%
mutate( date = as.Date(date , format="%Y-%m-%d")) %>%
rename(indicerevalo=valeur_point_en_euros) %>%
select(date,cc,indicerevalo)
tab_rev <- expand.grid(
annee=c(1949:2022) ,
cc=as.vector(unique(  c(tab_rev_base$cc, tab_rev_compl$cc)) ),
stringsAsFactors = FALSE )  %>%
mutate(date = paste0(as.character(annee),"-12-31") %>% as.Date( format="%Y-%m-%d"))
tab_rev <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = format(date,format="%Y") %>% as.numeric(),
mois = format(date,format="%m") %>% as.numeric(),
jour = format(date,format="%d") %>% as.numeric()) %>%
relocate("annee",.after="date")  %>%
relocate("indicerevalo",.after="jour")
View(tab_rev)
revalopensions <- bind_rows( tab_rev, tab_rev_base, tab_rev_compl) %>%
arrange(cc,date) %>%
group_by(cc) %>% fill(indicerevalo,.direction="down") %>% ungroup() %>%
mutate(annee = format(date,format="%Y") %>% as.numeric(),
mois = format(date,format="%m") %>% as.numeric(),
jour = format(date,format="%d") %>% as.numeric()) %>%
relocate("annee",.after="date")  %>%
relocate("indicerevalo",.after="jour")
usethis::use_data( revalopensions ,      overwrite=TRUE)
document()
build()
load_all()
