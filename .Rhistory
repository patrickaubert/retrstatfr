library(devtools)
library(usethis)
library(tidyverse)
getwd()
sources_opendata <- read.csv2("data-raw/sources_open_data.csv")
View(sources_opendata)
sources_opendata <- read.csv2("data-raw/sources_open_data.csv", encoding="UTF-8")
View(sources_opendata)
usethis::use_data(sources_opendata)
sources_opendata <- read.csv2("data-raw/sources_open_data.csv", encoding="UTF-8")
usethis::use_data(sources_opendata)
sources_opendata <- read.csv2("data-raw/sources_open_data.csv", encoding="UTF-8")
usethis::use_data(sources_opendata)
usethis::use_data(sources_opendata, overwrite=TRUE)
document()
unique(sources_opendata$intitule)
use_import_from("openxlsx", "read.xlsx")
library(devtools)
library(usethis)
use_import_from("openxlsx", "read.xlsx")
usethis::use_import_from("openxlsx", "read.xlsx")
library(usethis)
?use_import_from
?usethis
build()
?read.xlsx
library(openxlsx)
?read.xlsx
intitule<-"txretr"
datepubli = NULL
champ_sexe = NULL
champ_geo = NULL
champ_autre = NULL
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
intituleloc
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
donnees <- sources_opendata %>% filter(intitule==intituleloc)
if (!is.null(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.null(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
View(donnees)
i<-2
donnees[i,c("intitule","datepubli","champ_sexe","champ_geo","champ_autre")]
donnees <- donnees[1,]
donnees
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
colNames = TRUE, rowNames = FALSE,
namesRegion = donnees$zone
)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
colNames = TRUE, rowNames = FALSE,
namesRegion = donnees$zone
)
donnees$zone
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
colNames = TRUE, rowNames = FALSE,
namedRegion = donnees$zone
)
vals <- read.xlsx(
xlsxFile = donnees$url)
View(vals)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
colNames = TRUE, rowNames = FALSE)
View(vals)
library(readxl)
vals <- read_excel(
donnees$url,
sheet = donnees$onglet,
range = donnees$zone
)
as.numeric("b")
asnumeric("b")
as.numeric("b")
b+0
unquo("c(1:4)")
enquo("c(1:4)")
unquote("c(1:4)")
eval("c(1:4)")
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
colNames = TRUE, rowNames = FALSE),
namedRegion = donnees$zone
)
View(vals)
vals <- read_excel(
donnees$url,
sheet = donnees$onglet,
range = donnees$zone
)
View(sources_opendata)
library(googlesheets)
install.packages("googlesheets")
library(googlesheets)
install.packages("cellranger")
library(cellranger)
letter_to_num("B2:AA25")
R1C1_to_A1(c("B2:AA25"), strict = FALSE)
as.cell_limits("B2:AA25")
as.cell_limits("B2:AA25") %>% as.numeric()
cell_rows("B2:AA25")
as.cell_limits("B2:AA25")[1]
as.cell_limits("B2:AA25")$ul
as.cell_limits("B2:AA25") %>% addr_row()
as.cell_limits("B2:AA25") %>% cell_rows()
as.cell_limits$ul[1]
as.cell_limits("B2:AA25")$ul[1]
donnees$zone
rangecells <- cellranger::as.cell_limits(donnees$zone)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
rows = c(rangecells$ul[1]:rangecells$lr[1]),
cols = c(rangecells$ul[2]:rangecells$lr[2]),
colNames = TRUE, rowNames = FALSE
)
View(vals)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
rows = c(rangecells$ul[1]:rangecells$lr[1]),
cols = c(rangecells$ul[2]:rangecells$lr[2]),
colNames = TRUE, rowNames = FALSE
) %>%
janitor::clean_names()
View(vals)
donnees
cols_an <- names(vals)[grepl("^x[[:digit:]]{4}$",names(vals))]
cols_an
?pivot_longer
?str_replace
vals <- vals %>%
pivot_longer(cols=cols_an,names_to="annee",values_to=valeurs) %>%
mutate(annee = annee %>% str_replace("[^[:digit:]]","") %>% as.numeric() )
vals <- vals %>%
pivot_longer(cols=cols_an,names_to="annee",values_to="valeurs") %>%
mutate(annee = annee %>% str_replace("[^[:digit:]]","") %>% as.numeric() )
View(vals)
donnees
if (!is.null(donnees$champ_sexe)) {vals <- vals %>% filter(sexe==donnees$champ_sexe)}
if (!is.null(donnees$champ_geo)) {vals <- vals %>% filter(geo==donnees$champ_geo)}
if (!is.null(donnees$champ_autre)) {vals <- vals %>% filter(champ_autre==donnees$champ_autre)}
if (!is.null(donnees$champ_sexe)) {vals <- vals %>% mutate(sexe=donnees$champ_sexe)}
if (!is.null(donnees$champ_geo)) {vals <- vals %>% mutate(geo=donnees$champ_geo)}
if (!is.null(donnees$champ_autre)) {vals <- vals %>% mutate(champ_autre=donnees$champ_autre)}
View(vals)
load_all()
txretr <- extrait_opendata("txretr")
intitule <- "txretr"
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
intituleloc
txretr <- extrait_opendata(intitule="txretr")
intitule="txretr"
datepubli = NULL
champ_sexe = NULL
champ_geo = NULL
champ_autre = NULL
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {error("Intitulé non retrouvé")}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
donnees <- sources_opendata %>% filter(intitule==intituleloc)
if (!is.null(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.null(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
View(donnees)
i<-1
donnees[i,c("intitule","datepubli","champ_sexe","champ_geo","champ_autre")]
load_all()
txretr <- extrait_opendata("txretr")
txretr <- extrait_opendata("txretr",champ_sexe="femmes")
View(txretr)
txretr <- extrait_opendata("txretr",champ_sexe="hommes")
View(txretr)
txretr <- extrait_opendata("txretr",champ_sexe="ensemble")
txretr <- extrait_opendata("txretr",champ_sexe="ensembles")
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {error("Intitulé non retrouvé")}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
# == extraction des données
donnees <- sources_opendata %>% filter(intitule==intituleloc)
if (!is.null(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.null(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
nrow(donnees)
c(1:nrow(donnees))
donnees$zone
i<-1
donnees[i,]$intitule
donnees[i,]$datepubli
donnees[i,]$champ_sexe
donnees[i,]$champ_geo
donnees[i,]$champ_autre
truc <- extrait_opendata(donnees[i,]$intitule,donnees[i,]$datepubli,donnees[i,]$champ_sexe,donnees[i,]$champ_geo,donnees[i,]$champ_autre)
intitule=donnees[i,]$intitule
datepubli=donnees[i,]$datepubli
champ_sexe=donnees[i,]$champ_sexe
champ_geo=donnees[i,]$champ_geo
champ_autre=donnees[i,]$champ_autre
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {error("Intitulé non retrouvé")}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
donnees <- sources_opendata %>% filter(intitule==intituleloc)
View(donnees)
if (!is.null(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
View(donnees)
champ_autreloc
if (!is.null(champ_autreloc) & !is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
donnees <- sources_opendata %>% filter(intitule==intituleloc)
if (!is.null(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.null(champ_autreloc) & !is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
load_all()
txretr <- extrait_opendata("txretr")
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {error("Intitulé non retrouvé")}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
# == extraction des données
donnees <- sources_opendata %>% filter(intitule==intituleloc)
View(donnees)
if (!is.null(datepubliloc) & !is.na(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.null(champ_sexeloc) & !is.na(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.null(champ_geoloc) & !is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.null(champ_autreloc) & !is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
View(donnees)
View(donnees)
(nrow(donnees)>1)
rangecells <- cellranger::as.cell_limits(donnees$zone)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
rows = c(rangecells$ul[1]:rangecells$lr[1]),
cols = c(rangecells$ul[2]:rangecells$lr[2]),
colNames = TRUE, rowNames = FALSE
) %>%
janitor::clean_names()
View(vals)
donnees$annees_en_colonnes
if (donnees$annees_en_colonnes) {
cols_an <- names(vals)[grepl("^x[[:digit:]]{4}$",names(vals))]
vals <- vals %>%
pivot_longer(cols=cols_an,names_to="annee",values_to="valeurs") %>%
mutate(annee = annee %>% str_replace("[^[:digit:]]","") %>% as.numeric() )
}
if (!is.null(donnees$champ_sexe)) {vals <- vals %>% mutate(sexe=donnees$champ_sexe)}
if (!is.null(donnees$champ_geo)) {vals <- vals %>% mutate(geo=donnees$champ_geo)}
if (!is.null(donnees$champ_autre)) {vals <- vals %>% mutate(champ_autre=donnees$champ_autre)}
View(vals)
intitule
datepubli
champ_sexe
champ_geo
champ_autre
is.na(champ_autre)
txretr <- extrait_opendata("txretr",champ_sexe="ensemble")
datepubliloc<-NULL
!is.null(datepubliloc)
!is.na(datepubliloc)
is.nullorna <- function(x){case_when(is.null(x) ~ TRUE, is.na(x) ~ TRUE, TRUE ~ FALSE)}
is.nullorna(NULL)
is.nullorna(datepubliloc)
is.null(datepubliloc)
is.na(datepubliloc)
load_all()
txretr <- extrait_opendata("txretr",champ_sexe="ensemble")
View(txretr)
txretr <- extrait_opendata("txretr")
View(txretr)
txretr <- extrait_opendata("txretr",champ_sexe="ensemble")
txretr <- extrait_opendata("txretr")
intitule
datepubli
datepubli = NA
champ_sexe = NA
champ_geo = NA
champ_autre = NA
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {error("Intitulé non retrouvé")}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
# == extraction des données
donnees <- sources_opendata %>% filter(intitule==intituleloc)
if (!is.na(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.na(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
(nrow(donnees)>1)
c(1:nrow(donnees))
tab <- do.call(
"bind_rows",
lapply(c(1:nrow(donnees)),
function(i){extrait_opendata(donnees[i,]$intitule,donnees[i,]$datepubli,donnees[i,]$champ_sexe,donnees[i,]$champ_geo,donnees[i,]$champ_autre)})
)
load_all()
txretr <- extrait_opendata("txretr")
View(txretr)
sources_opendata$intitule
depretr <- extrait_opendata("dépenses de retraite en % du pib")
intitule<-"dépenses de retraite en % du pib"
intituleloc <- recode(intitule,
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
intituleloc
(intituleloc %in% sources_opendata$intitule)
sources_opendata$intitule
depretr <- extrait_opendata("rapport nombre cotisants sur retraités")
depretr <- extrait_opendata("pension moyenne relative")
View(depretr)
library(devtools)
library(usethis)
library(tidyverse)
# library(openxlsx)
txretr <- extrait_opendata("txretr
")
load_all()
txretr <- extrait_opendata("txretr")
library(openxlsx)
txretr <- extrait_opendata("txretr")
View(txretr)
txretr <- txretr %>% rename(txretr=valeurs) %>% mutate(txretr = txretr/10
0)
txretr <- txretr %>% rename(txretr=valeurs) %>% mutate(txretr = txretr/100)
View(txretr)
usethis::use_data(txretr, overwrite=TRUE)
View(txretr)
min(txretr$age)
max(txretr$age)
unique(txretr$sexe)
load_all()
build()
document()
View(txretr)
View(sources_opendata)
txretr <- extrait_opendata("txretr")
txnvretr <- extrait_opendata("taux de nouveaux retraités par âge")
View(txnvretr)
txnvretr <- txnvretr %>% rename(txnvretr=valeurs,age=x1) %>% mutate(txnvretr = txnvretr/100)
View(txnvretr)
txnvretr <- extrait_opendata("taux de nouveaux retraités par âge")
txnvretr <- txnvretr %>% rename(txnouvretr=valeurs,age=x1) %>% mutate(txnvretr = txnvretr/100)
txretr <- extrait_opendata("txretr")
txretr <- txretr %>% rename(txretr=valeurs) %>% mutate(txretr = txretr/100)
txnvretr <- extrait_opendata("taux de nouveaux retraités par âge")
txnvretr <- txnvretr %>% rename(txnouvretr=valeurs,age=x1) %>% mutate(txnouvretr = txnouvretr/100)
txretr <- left_join(txretr,txnvretr, by=c("age","annee","sexe","geo"))
txretr <- left_join(txretr,txnvretr, by=c("age","annee","sexe","geo"))
txretr <- extrait_opendata("txretr")
txretr <- txretr %>% rename(txretr=valeurs) %>% mutate(txretr = txretr/100)
txnvretr <- extrait_opendata("taux de nouveaux retraités par âge")
txnvretr <- txnvretr %>% rename(txnouvretr=valeurs,age=x1) %>% mutate(txnouvretr = txnouvretr/100)
txretr <- full_join(txretr,txnvretr, by=c("age","annee","sexe","geo"))
View(txretr)
usethis::use_data(txretr, overwrite=TRUE)
document()
document()
build()
