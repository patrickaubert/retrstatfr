if (!is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
nrow(donnees)
if (!(length(donnees$zone)==1L)) {warning(paste("Problème rencontré pour la série ",donnees$intitulecourt))}
rangecells <- cellranger::as.cell_limits(donnees$zone)
vals <- read.xlsx(
xlsxFile = donnees$url,
sheet = donnees$onglet,
rows = c(rangecells$ul[1]:rangecells$lr[1]),
cols = c(rangecells$ul[2]:rangecells$lr[2]),
colNames = TRUE, rowNames = FALSE
) %>%
janitor::clean_names()
View(vals)
load_all()
truc <- extrait_opendata("taux de retraités")
load_all()
truc <- extrait_opendata("taux de retraités")
View(truc)
truc <- extrait_opendata("taux de nouveaux retraités par âge")
View(truc)
truc <- extrait_opendata("fancyseries")
intitule <- "autre serie"
intitulecourtloc <- intitulecourt
if (!is.null(intitule)) {
intituleloc <- recode(enc2utf8(intitule),
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {warning(paste0("Intitulé '",intituleloc,"' non retrouvé"))}
}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
# == extraction des données
if (!is.null(intitulecourt)) { donnees <- sources_opendata %>% filter(intitulecourt==intitulecourtloc)
} else { donnees <- sources_opendata %>% filter(intitule==intituleloc) }
if (!is.na(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.na(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
nrow(donnees)
load_all()
intitule <- "autre serie"
truc <- extrait_opendata("fancyseries")
load_all()
truc <- extrait_opendata("fancyseries")
load_all()
truc <- extrait_opendata("fancyseries")
load_all()
truc <- extrait_opendata("fancyseries")
intituleloc
paste(
paste0("Intitulé '",intituleloc,"' non retrouvé.\nLes séries disponibles sont : "),
unique(sources_opendata$intitule),collapse=" ; ")
paste0(
"Intitulé '",intituleloc,"' non retrouvé.\nLes séries disponibles sont : ",
paste(unique(sources_opendata$intitule),collapse=" ; ") )    )
paste(unique(sources_opendata$intitule),collapse=" ; ")
paste0(
"Intitulé '",intituleloc,"' non retrouvé.\nLes séries disponibles sont : ",
paste(unique(sources_opendata$intitule),collapse=" ; ") )
paste0(
"Intitulé '",intituleloc,"' non retrouvé. Les séries disponibles sont : ",
paste(unique(sources_opendata$intitule)) )
paste0(
"Intitulé '",intituleloc,"' non retrouvé. Les séries disponibles sont : ",
paste(unique(sources_opendata$intitule)),collapse=" ; " )
paste0(
"Intitulé '",intituleloc,"' non retrouvé. Les séries disponibles sont : ",
paste(unique(sources_opendata$intitule),collapse=" ; ")  )
load_all()
truc <- extrait_opendata("serie bidule")
load_all()
truc <- extrait_opendata("les droits validés en cours de carriere (EIC 2017)")
truc <- extrait_opendata("les droits validés en cours de carrière (EIC 2017)")
truc <- extrait_opendata("les droits validés en cours de carrière (EIC 2017)")
load_all()
sources_opendata <- read.csv2("data-raw/sources_open_data.csv", encoding="UTF-8")
usethis::use_data(sources_opendata, overwrite=TRUE)
load_all()
truc <- extrait_opendata("les droits validés en cours de carrière (EIC 2017)")
intitule<-"les droits validés en cours de carrière (EIC 2017)"
intitulecourtloc <- intitulecourt
if (!is.null(intitule)) {
intituleloc <- recode(enc2utf8(intitule),
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {
stop( paste0(
"Intitulé '",intituleloc,"' non retrouvé. Les séries disponibles sont : ",
paste(unique(sources_opendata$intitule),collapse=" ; ")  )    )
}
}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
if (!is.null(intitulecourt)) { donnees <- sources_opendata %>% filter(intitulecourt==intitulecourtloc)
} else { donnees <- sources_opendata %>% filter(intitule==intituleloc) }
if (!is.na(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.na(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
nrow(donnees)
(!(intituleloc %in% sources_opendata$intitule))
intitulecourt
intituleloc
if (!is.null(intitulecourt)) { donnees <- sources_opendata %>% filter(intitulecourt==intitulecourtloc)
} else { donnees <- sources_opendata %>% filter(intitule==intituleloc) }
View(donnees)
datepubli = NA
champ_sexe = NA
champ_geo = NA
champ_autre = NA
intitulecourtloc <- intitulecourt
if (!is.null(intitule)) {
intituleloc <- recode(enc2utf8(intitule),
"taux de retraités" = "taux de retraités par âge",
"txretr" = "taux de retraités par âge",
"taux de nouveaux retraités" = "taux de nouveaux retraités par âge",
"tauxnouvretr" = "taux de nouveaux retraités par âge")
if (!(intituleloc %in% sources_opendata$intitule)) {
stop( paste0(
"Intitulé '",intituleloc,"' non retrouvé. Les séries disponibles sont : ",
paste(unique(sources_opendata$intitule),collapse=" ; ")  )    )
}
}
datepubliloc <- datepubli
champ_sexeloc <- champ_sexe
champ_geoloc <- champ_geo
champ_autreloc <- champ_autre
# == extraction des données
if (!is.null(intitulecourt)) { donnees <- sources_opendata %>% filter(intitulecourt==intitulecourtloc)
} else { donnees <- sources_opendata %>% filter(intitule==intituleloc) }
if (!is.na(datepubliloc)) {donnees <- donnees %>% filter(datepubli==datepubliloc)}
if (!is.na(champ_sexeloc)) {donnees <- donnees %>% filter(champ_sexe==champ_sexeloc)}
if (!is.na(champ_geoloc)) {donnees <- donnees %>% filter(champ_geo==champ_geoloc)}
if (!is.na(champ_autreloc)) {donnees <- donnees %>% filter(champ_autre==champ_autreloc)}
(nrow(donnees)>1)
(grepl("csv$",donnees$url))
donnees$url
(grepl("csv(/|)$",donnees$url))
vals <- read.csv2(file==donnees$url,
header=TRUE,sep=";")
vals <- read.csv2(file=donnees$url,
header=TRUE,sep=";")
View(vals)
load_all()
truc <- extrait_opendata("les droits validés en cours de carrière (EIC 2017)")
View(truc)
View(projcor)
library(devtools)
load_all()
check()
document()
build()
document()
check()
build()
load_all()
library(devtools)
load_all()
library(devtools)
load_all()
check()
document()
check()
library(pkgdown)
build_site()
build_site()
infocasd <- read.csv2(file=urlcasd)
urlcasd <- "https://www.casd.eu/generate-csv/?language=fr&id_src=445"
urlprogedo <- "https://data.progedo.fr/documents/adisp/lil-1535/EIR_2016_Dictionnaire_des_variables_selon_diffusion_pourProgedo.xlsx"
sheetprogedo <- "INDIV16"
infocasd <- read.csv2(file=urlcasd)
?read.csv2
infocasd <- read.table(file=urlcasd)
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="##")
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="##")
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="#")
View(infocasd)
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="#",encoding="UTF-8")
View(infocasd)
infocasd- <- infocasd
infocasd_ <- infocasd
infocasd <- infocasd %>%
mutate(lignevar = ifelse(grepl(";",V1),V1,NA),
ligneinfo = ifelse(!grepl(";",V1),V1,NA)) %>%
select(-V1) %>%
fill(ligneinfo,.direction="down")
library(tidyverse)
infocasd <- infocasd_ %>%
mutate(lignevar = ifelse(grepl(";",V1),V1,NA),
ligneinfo = ifelse(!grepl(";",V1),V1,NA)) %>%
select(-V1) %>%
fill(ligneinfo,.direction="down")
View(infocasd)
unique(infocasd$ligneinfo)
infocasd <- infocasd_ %>%
mutate(lignevar = ifelse(grepl(";",V1),V1,NA),
lignenomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
ligneinfo = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(lignenomtab,.direction="down")
View(infocasd)
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;];[^;];",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;];[^;];",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
View(infocasd)
"str_replace("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"str_replace("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"str_replace_all("SEXE;Sexe;1 - Homme;2 - Femme","^[^;];[^;];","")
"SEXE;Sexe;1 - Homme;2 - Femme" %>% str_replace("^[^;];[^;];","")
"SEXE;Sexe;1 - Homme;2 - Femme" %>% str_replace("^[^;]","")
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]+;[^;]+;"),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]+;[^;]+;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1) %>%
fill(nomtab,.direction="down")
View(infocasd)
View(infocasd)
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & novmar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & novmar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
infocasd <- infocasd_ %>%
mutate(nomvar = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(nomvar) & nomvar!="Nom de la variable") %>%
mutate(nomtab = nomtab %>% str_replace_all("2012|(?<!0)12",""))
View(infocasd)
infocasd <- infocasd_ %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
nomtab = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(nomtab,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(nomtab = nomtab %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
View(infocasd)
infocasd <- infocasd_ %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
table = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(table,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(table = table %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
infocasd <- read.csv2(file=urlcasd,header=FALSE,sep="#",encoding="UTF-8")
variables_eir <- infocasd %>%
mutate(variable = ifelse(grepl(";",V1),str_extract(V1,"^[^;]+(?=;)"),NA),
libelle = ifelse(grepl(";",V1),str_extract(V1,"(?<=^[^;]{0,40};)[^;]+(?=;)"),NA),
modalites = ifelse(grepl(";",V1),str_replace(V1,"^[^;]*;[^;]*;",""),NA),
table = ifelse(!grepl(";|[[:space:]]",V1),V1,NA),
info = ifelse(!grepl(";",V1) & grepl("[[:space:]]",V1),V1,NA)) %>%
select(-V1,-info) %>%
fill(table,.direction="down") %>%
filter(!is.na(variable) & variable!="Nom de la variable") %>%
mutate(table = table %>%
str_replace_all("2012|(?<!0)12","") %>%
str_replace_all("eir_|_eir",""))
View(variables_eir)
View(variables_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites))
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace(modalites,"[^;]","")+1))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace(modalites,"[^;]",""))+1)
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1)
View(modalites_eir)
?slice
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
slice(rep(1:n()), each=nbmodalites)
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n()), each=nbmodalites) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
#group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
ungroup()
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(strsplit(modalites,";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,sep=";"))) %>%
ungroup()
unlist(str_split(modalites_eir$modalites[1],sep=";"))
unlist(strsplit(modalites_eir$modalites[1],sep=";"))
?strsplit
unlist(strsplit(modalites_eir$modalites[1],split=";"))
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites,split=";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(str_split(modalites[1],split=";"))) %>%
ungroup()
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalites = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup()
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalite = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup() %>%
mutate(intitule = modalite %>% str_replace("^[^\\-]*\\-[[:space:]]*",""),
modalite = modalite %>% str_extract("^[^\\-]*") %>% trimws())
View(modalites_eir)
modalites_eir <- variables_eir %>%
filter(grepl(";",modalites)) %>%
select(table,variable,modalites) %>%
mutate(nbmodalites=nchar(str_replace_all(modalites,"[^;]",""))+1) %>%
group_by(table,variable) %>%
slice(rep(1:n(), each=nbmodalites)) %>%
mutate(modalite = unlist(strsplit(modalites[1],split=";"))) %>%
ungroup() %>%
mutate(intitule = modalite %>% str_replace("^[^\\-]*\\-[[:space:]]*",""),
modalite = modalite %>% str_extract("^[^\\-]*") %>% trimws()) %>%
select(table,variable,modalite,intitule)
View(modalites_eir)
usethis::use_data(variables_eir, modalites_eir,      overwrite=TRUE)
# == sauvegarde des bases en format .csv
write.csv2(variables_eir,
file=gzfile("data-raw/variables_eir.csv.gz"),
row.names = FALSE, fileEncoding = "UTF-8")
write.csv2(modalites_eir,
file=gzfile("data-raw/modalites_eir.csv.gz"),
row.names = FALSE, fileEncoding = "UTF-8")
document()
var<- "depant"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(var)) %>%
select(modalite,intitule) %>%
distinct()
tab
setNames(tab$modalite,tab$intitule)
truc <- setNames(tab$modalite,tab$intitule)
recode(c("2","1","3"), !!! truc
)
truc
truc <- setNames(tab$intitule,tab$modalite)
recode(c("2","1","3"), !!! truc)
var <- c("1","4",NA)
novmar<-"typdd"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
nomvar<-"typdd"
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
nomvar<-"depant"
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
setNames(tab$intitule , tab$modalite)
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) )
recode_modalites_eir <- function(nomvar) {
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
return( recode(as.character({{nomvar}}), !!! setNames(tab$intitule , tab$modalite) ) )
}
depant <- c(1,2,3,4)
recode_modalites_eir("depant")
recode_modalites_eir(depant)
recode_modalites_eir(depant,"depant")
recode_modalites_eir <- function(var,nomvar=NA) {
tab <- modalites_eir %>% filter(tolower(variable)==tolower(nomvar)) %>%
select(modalite,intitule) %>%
distinct()
return( recode(as.character(var), !!! setNames(tab$intitule , tab$modalite) ) )
}
recode_modalites_eir(depant)
recode_modalites_eir(depant,"depant")
load_all()
load_all()
rm(list = c("recode_modalites_eir"))
load_all()
load_all()
document()
build_site()
